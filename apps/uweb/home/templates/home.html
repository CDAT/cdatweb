<html>
    <title>Diagnostics</title>
    <link rel="stylesheet" href="{{STATIC_URL}}lib/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="{{STATIC_URL}}css/jquery-ui-1.10.0.css"/>
    <script src="{{STATIC_URL}}ext/js-core/jquery-1.8.3.min.js"></script>
    <script src="{{STATIC_URL}}lib/js/bootstrap.min.js"></script>

        <script src="{{STATIC_URL}}ext/js-core/autobahn.min.js"></script>
	<script src="{{STATIC_URL}}ext/js-core/gl-matrix-min.js"></script>
        <script src="{{STATIC_URL}}ext/js-core/jquery.hammer.min.js"></script>

        <script src="{{STATIC_URL}}ext/widgets/jscolor/jscolor.js"></script>
        <script src="{{STATIC_URL}}ext/widgets/jquery-ui/jquery-ui-1.10.0.min.js"></script>

        <script src="{{STATIC_URL}}lib/js/vtkweb-all.js"></script>
        <script src="{{STATIC_URL}}lib/js/uvis.js"></script>
<body>
    <nav class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <a class="navbar-brand" href="http://uvcdat.llnl.gov">UV-CDAT Live</a>
        </div>
        <div>
            <p class="navbar-text navbar-right">
            <a href="#" class="navbar-link">448000</a>&nbsp;|
            <a href="logout" class="navbar-link">Logout</a>
            </p>
        </div>
    </nav>
    <div class="row">
        <div class="col-md-2" id="Left">
            <ul class="nav nav-tabs" id=projectTab>
                <li class=active> <a href="#Project1" data-toggle="tab">Project1</a></li>
                <li> <a href="#Sheet2" data-toggle="tab">+</a></li>
            </ul>
            <div class="tab-pane active" id="Project1">
                <div class=row>
                    <div class="col-md-12" id="Project1Div" style="height:720px;box-shadow: 0 0 2px grey">
                    </div>
                </div>
                    <h4>&nbsp;<span class="label label-default">Plots</span></h4>
                        <div id="plot_type_selection" class=col-md-13>
                            <div class="btn-group dropup">
                                <button type="button" class="btn btn-default" style="width:260px;">DV3D</button>
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" style="width:30px;height:34px;">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">Curtain Plot</a></li>
                                    <li><a href="#">Glyph Slicer</a></li>
                                    <li><a href="#">Glyph Volume</a></li>
                                    <li><a href="#">Hovmoller Slicer</a></li>
                                    <li><a href="#">Hovmoller Volume</a></li>
                                    <li><a href="#">IsoSurface</a></li>
                                    <li><a href="#">IsoSurface With Texture</a></li>
                                    <li><a href="#">Slicer</a></li>
                                    <li><a href="#">Slicer With Contours</a></li>
                                    <li><a href="#">Streamline Slicer</a></li>
                                    <li><a href="#">Volume Render</a></li>
                                    <li><a href="#">Volume Render With Slicer</a></li>
                                </ul>
                            </div>
                            <br>
                            <div class="btn-group dropup">
                                <button type="button" class="btn btn-default" style="width:260px;">            VCS</button>
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" style="width:30px;height:34px;">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">Boxfill</a></li>
                                    <li><a href="#">Isofill</a></li>
                                    <li><a href="#">Isoline</a></li>
                                    <li><a href="#">Meshfill</a></li>
                                   <li><a href="#">Outfill</a></li>
                                   <li><a href="#">Scatter</a></li>
                                   <li><a href="#">TaylorDiagram</a></li>
                                   <li><a href="#">Vector</a></li>
                                   <li><a href="#">XvsY</a></li>
                                   <li><a href="#">XyvsY</a></li>
                                   <li><a href="#">YxvsX</a></li>
                                </ul>
                            </div>
                        </div>
            </div>
        </div>
        <div class="col-md-7" id="Center">
            <ul class="nav nav-tabs" id=sheetTab>
                <li class=active> <a class=sheetTabAnchor data-toggle="tab">Sheet1</a></li>
                <li id='lastSheet'> <a href="#Sheet1" data-toggle="tab">+</a></li>
            </ul>
            <div class="tab-pane active" id="Sheet1">
                    <div class="btn-group btn-group-xs">
                        <button type="button" class="btn btn-default">
                            <img src="{{STATIC_URL}}img/delete.png" class="img-rounded" style="height:25px;width:25px;vertical-align:middle;"></img>
                        </button>
                        <button type="button" class="btn btn-default">
                            <img src="{{STATIC_URL}}img/source.png" class="img-rounded" style="height:25px;width:25px;vertical-align:middle;"></img>
                        </button>
                        <button type="button" class="btn btn-default">
                            <img src="{{STATIC_URL}}img/pipeline.png" class="img-rounded" style="height:25px;width:25px;vertical-align:middle;"></img>
                        </button>
                        <button type="button" class="btn btn-default">
                            <img src="{{STATIC_URL}}img/previous.png" class="img-rounded" style="height:25px;width:25px;vertical-align:middle;"></img>
                        </button>
                        <button type="button" class="btn btn-default">
                            <img src="{{STATIC_URL}}img/next.png" class="img-rounded" style="height:25px;width:25px;vertical-align:middle;"></img>
                        </button>
                        <button type="button" class="btn btn-default">
                            <img src="{{STATIC_URL}}img/printer.png" class="img-rounded" style="height:25px;width:25px;vertical-align:middle;"></img>
                        </button>
                        <button type="button" class="btn btn-default">
                            <img src="{{STATIC_URL}}img/file_export.png" class="img-rounded" style="height:25px;width:25px;vertical-align:middle;"></img>
                        </button>
                    </div>
                <div class=row>
                    <div class="col-md-6" id="Sheet1Canvas1" style="height:400px;box-shadow: 0 0 2px grey">
                                <div id="data1"></div>
            			<div id="viewport-container1" ></div>
                    </div>
                    <div class="col-md-6" id="Sheet1Canvas2" style="height:400px;box-shadow: 0 0 2px grey">
                                <div id="data2"></div>
                        <div id="viewport-container2" ></div>
                    </div>
                </div>
                <div class=row>
                    <div class="col-md-6" id="Sheet1Canvas3" style="height:400px;box-shadow: 0 0 2px grey">
                                <div id="data3"></div>
            			<div id="viewport-container3" ></div>
                    </div>
                    <div class="col-md-6" id="Sheet1Canvas4" style="height:400px;box-shadow: 0 0 2px grey">
                                <div id="data4"></div>
            			<div id="viewport-container4" ></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3" id="Right">
            <ul class="nav nav-tabs" id=diagTab>
                <li> <a href="#Variables" data-toggle="tab">Variables</a></li>
                <li> <a href="#Diagnostic" data-toggle="tab">Diagnostic</a></li>
                <li class=active> <a href="#ESGF" data-toggle="tab">ESGF</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane" id="Variables">
                    <div class="btn-group btn-group-xs">
                        <button type="button" class="btn btn-default" onclick="deleteSelectedVariables()">
                            <img class=img-rounded src={{STATIC_URL}}img/delete.png style="height:25px;width:25px;vertical-align:middle;"  />
                        </button>
                        <button type="button" class="btn btn-default" onclick="checkAllVariables()">
                            <img class=img-rounded src={{STATIC_URL}}img/checked.png style="height:25px;width:25px;vertical-align:middle;"/>
                        </button>
                        <button type="button" class="btn btn-default" onclick="editSelectedVariables()">
                            <img class=img-rounded src={{STATIC_URL}}img/edit.png style="height:25px;width:25px;vertical-align:middle;"/>
                        </button>
                        <button type="button" class="btn btn-default">
                            <img class=img-rounded src={{STATIC_URL}}img/file_save.png style="height:25px;width:25px;vertical-align:middle;"/>
                        </button>
                        <button type="button" class="btn btn-default" onclick="resetVariables()">
                            <img class=img-rounded src={{STATIC_URL}}img/preferences.png style="height:25px;width:25px;vertical-align:middle;"/>
                        </button>
                    </div>
                    <div class=row>
                        <div class="col-md-11" id="var_panel" style="height:620px;box-shadow: 0 0 2px grey">
                        </div>
                    </div>
                    <div class=row>
                        <div id=calculator>
                            <table id="calc_table1" >
                                <tr><td colspan=6><input style="width:444px;" type=text id=array_name placeholder="Result Array Name"/></td></tr>
                                <tr><td colspan=6><input style="width:444px;" type=text id=calc_command placeholder="Enter a CDAT command"/></td></tr>
                                <tr>
                                    <td><button style="width:72px;" id=sin_btn>sin</button></td>
                                    <td><button style="width:72px;" id=asin_btn>asin</button></td>
                                    <td><button style="width:72px;" id=sqr>x^2</button></td>
                                    <td><button style="width:72px;" id=nat_log>ln</button></td>
                                    <td><button style="width:72px;" id=x_less_than_y>x&lt;y</button></td>
                                    <td><button style="width:72px;" id=plus>+</button></td>
                                </tr>
                                <tr>
                                    <td><button style="width:72px;" id=cos_btn>cos</button></td>
                                    <td><button style="width:72px;" id=acos_btn>acos</button></td>
                                    <td><button style="width:72px;" id=sqrt>sqrt</button></td>
                                    <td><button style="width:72px;" id=log10>log10</button></td>
                                    <td><button style="width:72px;" id=x_greater_than_y>x&gt;y</button></td>
                                    <td><button style="width:72px;" id=minus>-</button></td>
                                </tr>
                                <tr>
                                    <td><button style="width:72px;" id=tan_btn>tan</button></td>
                                    <td><button style="width:72px;" id=atan_btn>atan</button></td>
                                    <td><button style="width:72px;" id=invert_btn>1/x</button></td>
                                    <td><button style="width:72px;" id=exp_btn>exp</button></td>
                                    <td><button style="width:72px;" id=x_compare_y>x&lt;&gt;y</button></td>
                                    <td><button style="width:72px;" id=multiply>*</button></td>
                                </tr>
                                <tr>
                                    <td><button style="width:72px;" id=abs_btn>abs</button></td>
                                    <td><button style="width:72px;" id=std_btn>std</button></td>
                                    <td><button style="width:72px;" id=power_btn>x^y</button></td>
                                    <td><button style="width:72px;" id=10exp_btn>10^x</button></td>
                                    <td><button style="width:72px;" id=x_equal_y>x==y</button></td>
                                    <td><button style="width:72px;" id=divide>/</button></td>
                                </tr>
                            </table>
                            <table id="calc_table2">
                                <tr>
                                    <td><button style="width:109px;" id=regrid_btn>Regrid</button></td>
                                    <td><button style="width:109px;" id=mask_btn>Mask</button></td>
                                    <td><button style="width:109px;" id=get_mask_btn>Get_Mask</button></td>
                                    <td><button style="width:110px;" id=grower_btn>Grower</button></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="Diagnostic">
                    <div class="panel-group" id="diagAccordion">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title">
                                    <a data-toggle="collapse" data-parent="#diagAccordion" href="#diagCollapseOne">Submit a Job</a>
                                </div>
                            </div>
                            <div id="diagCollapseOne" class="panel-collapse collapse">
                                <div class="panel-body">
                                <form class="form-horizontal" role="form">
                                    <div class="form-group">
                                        <br>
                                        <label for="inputPackage" class="col-sm-2 control-label">Package</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="inputPackage">
                                                    <option value="AMWG"></option>
                                                    <option value="AMWG">AMWG</option>
                                                    <option value="LMWG">LMWG</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputObs" class="col-sm-2 control-label">Obs</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="inputObs">
                                                </select>
                                            </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPlotSet" class="col-sm-2 control-label">Set</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="inputPlotSet">
                                                </select>
                                            </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputSeason" class="col-sm-2 control-label">Season</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="inputSeason">
                                                </select>
                                            </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputVariable" class="col-sm-2 control-label">Variable</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="inputVariable">
                                                </select>
                                            </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputAux" class="col-sm-2 control-label">Auxiliary</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="inputAux">
                                                </select>
                                            </div>
                                    </div>
                                   <div class="form-group">
                                       <div class="col-sm-offset-2 col-md-2">
                                           <button type="submit" class="btn btn-default" id="diagSubmitJob">Submit</button>
                                       </div>
                                   </div>
                                </form>
                            </div>
                        </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title">
                                    <a data-toggle="collapse" data-parent="#diagAccordion" href="#diagCollapseTwo">Results</a>
                                </div>
                            </div>
                            <div id="diagCollapseTwo" class="panel-collapse collapse">
                                <table id = resultTable>
                                </table>
                            </div>
                        </div>
                </div> 
            </div>
                <div class="tab-pane active" id="ESGF">
                    <!--<form class="form-horizontal" role="form">-->
                        <br>
                        <div class="form-group">
                            <label for="inputEsgfSearch" class="col-sm-2 control-label">
                                <img class=img-rounded src={{STATIC_URL}}img/search.png style="height:25px;width:25px;vertical-align:middle;"/>
                            </label>
                            <div class="col-sm-9">
                                <input type=text class=form-control id=inputEsgfSearch value="cmip5.output1.INM.inmcm4.1pctCo2.mon">
                            </div>
                        </div>
                            
                        <div class="form-group">
                            <label for="inputDataNode" class="col-sm-2 control-label">
                                <img class=img-rounded src={{STATIC_URL}}img/database.png style="height:25px;width:25px;vertical-align:middle;"/>
                            </label>
                            <div class="col-sm-9">
                                <select class="form-control" id="inputDataNode">
                                    {% for data_node in data_node_list %}
                                        {% if data_node == "pcmdi9.llnl.gov" %}
                                            <option value={{data_node}} selected>{{data_node}}</option>
                                        {% else %}
                                            <option value={{data_node}}>{{data_node}}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-9 col-md-2">
                                <button type="submit" class="btn btn-primary" id="run_esgf_search">Search</button>
                            </div>
                        </div>
                        <!--</form>-->
                    <table id=esgf_result class="table table-striped">
                </div>
        </div>
    </div>
</div>
    <script type="text/javascript">
        $("#run_esgf_search").click(function() {
            var search_str=$("#inputEsgfSearch").val();
            $.ajax({url:'http://localhost:8000/plots/esgf',
                data:{"search_str":search_str},
                type:'GET',
                datatype:'json',
                success:function(res){
                    search_data = res["res"];
                    $("#esgf_result").empty();
                    $.each(search_data, function(i,item) {
                        var myFileID=search_data[i].fileID;
                        var myURL=search_data[i].url;
                        var first_td = '<td><a class=esgf_file_toggle><img src="{{STATIC_URL}}img/folder_blue_open.png"/></a><br><br><a class=esgf_file_var_import><img src="{{STATIC_URL}}img/save.png" width=15px/></a></td>';
                        var second_td= '<td style="word-break: break-all"><a id='+myURL+' class=esgf_file_download>'+myFileID+'</a><ul style="display:none;"></ul></td>';
                        var new_element = "<tr>"+first_td+second_td+"</tr>";
                        $(new_element).appendTo("#esgf_result");
                        })
                    },
                error: function(){alert('ERROR: Unable to search ESGF');}
            });
        });
        $('#esgf_result').on('click','a.esgf_file_toggle',function(e){
            myNode=$(this).parent().parent().children()[1].children[1];
            myFile=$(this).parent().parent().children()[1].children[0].id;
            myIdLen=myFile.length;
            myFile=myFile.substring(0,myIdLen-5);
            if (myNode.style.display=='none'){
                myNode.style.display='block';
                $.ajax({ url:"http://localhost:8000/plots/variable",
                    data:{"file":myFile},
                    datatype:'json',
                    success:function(res){
                        myVar=res['variable'];
                        $.each(myVar, function(i,item){
                            var myli="<li style='list-style-type:none;'><div class=checkbox><label class=draggable_to_canvas style='list-style-type:none'><input class=file_var type=checkbox>"+myVar[i]+"</label></div></li>";
                            $(myli).appendTo(myNode);
                        });
                        $('.draggable_to_canvas').draggable({
                            revert: true,
                            help: "clone",
                            cursor: "crosshair",
                            cursorAt: {left: 5},
                            });
                    },
                    error: function(){alert('Error: Unable to retrieve variables.');}
                });
            }
            else{
                myNode.style.display='none';
            }
        });

        $('#esgf_result').on('click','.draggable_to_canvas', function(){
            $('.draggable_to_canvas').draggable({
                revert: true,
                help: "clone",
                cursor: "crosshair",
                cursorAt: {left: 5},
                });
        });
        
        $("#Sheet1Canvas1").droppable({
            drop: function (event,ui){
                var draggableText=ui.draggable.text();
                console.log(draggableText);
                var droppableId=$(this).attr("id");
            }
        });


        function addSheet(){
            var myelement = document.getElementById('sheetTab');
            var lastNode=document.getElementById('lastSheet');
            var childrenList=$('#sheetTab').children();
            var total=childrenList.length;
            for (i=0;i<total;i++){
                var child=childrenList[i];
                if (child.hasAttribute('class')){
                    var newnode = child.cloneNode(true);
                    newnode.childNodes[1].innerHTML='Sheet'+total;
                    myelement.insertBefore(newnode,lastNode);
                    child.removeAttribute('class');
                    $('.sheetTabAnchor').click(function(e){ 
                        var tabIndex=parseInt(this.text.substring(5));
                        var newTabIndex=tabIndex-1; 
                        console.log(tabIndex); 
                    });
                }
            }
            return total;
        }

        $('.sheetTabAnchor').click(function(e){ 
            var tabIndex=parseInt(this.text.substring(5));
            var newTabIndex=tabIndex-1; 
            //myplot1.restore();
            console.log(tabIndex); 
        });

        function createHiddenInput(newID, newValue){
            var myInputTag="<input id="+newID+" type=hidden value=" + newValue +"/>";
            return myInputTag;
        }

        function toggle(task_id) {
            myDiv = document.getElementById(task_id);

            if (myDiv.style.display=='none')
            {
                myDiv.style.display='block';

                if (!myDiv.hasChildNodes())
                {
                    $.ajax({url: 'http://localhost:8000/diag/api/load_output/'+task_id+'/',
                        data:{},
                        type: 'GET',
                        success: function(data){
                            myList = data['output_list'];
                            inner_html='';
                            if (myList.length > 0) {
                                count = myList.length;
                                index = 0;
                                myplot1.setData(myList[index++]['fullpath'],function(){
                                    myplot1.save()
                                    myplot1.clear();
                                    myplot1.render();
                                    if (index < count){
                                        myplot2.setData(myList[index++]['fullpath'],function(){
                                            myplot2.clear();
                                            myplot2.render();
                                            if (index < count){
                                                myplot3.setData(myList[index++]['fullpath'], function(){
                                                    myplot3.clear();
                                                    myplot3.render();
                                                    if (index < count) {
                                                        myplot4.setData(myList[index++]['fullpath'], function() {
                                                            myplot4.clear();
                                                            myplot4.render();
                                                        });
                                                    }
                                                });
                                            }
                                        });
                                    }
                                });
                            }
                            var cur_sheet=1;
                            if (sessionStorage.diagcount){ 
                                console.log(sessionStorage.diagcount);
                                if (Number(sessionStorage.diagcount) > 1) {
                                    cur_sheet=addSheet();
                                }
                            }
                            for (var i = 0; i < myList.length; i++)
                            {
                                myTitle=myList[i]['filename'];
                                inner_html+=("<h6>"+myTitle+"</h6>"+createHiddenInput("Sheet"+(cur_sheet)+"Canvas"+(i+1),myList[i]['fullpath']));
                                var new_var=myList[i]['varlist'].toString();
                                varlist_str='';
                                varlist_str='(' + new_var + ')[Sheet' + cur_sheet+']';
                                var new_var_element='<li style=list-style-type:none>'+varlist_str+'</li>';
                                $('#var_panel').append(new_var_element);    
                                var new_prj_element='<li style=list-style-type:none>'+myTitle+'</li>';
                                $('#Project1Div').append(new_prj_element);

                            }
                            myDiv.innerHTML=inner_html;
                        },
                        error: function(){alert('ERROR: unable to load output');}
                    });
                }
            }
            else
            {
                myDiv.style.display='none';
            }
        }

        $('#diagTab a').click(function(e) {
            e.preventDefault();
            $(this).tab('show');
        });


        $('#diagSubmitJob').click(function(e) {
                e.preventDefault();
                if (sessionStorage.diagcount){
                    sessionStorage.diagcount=Number(sessionStorage.diagcount)+1;
                    
                }
                else {
                    sessionStorage.diagcount=1;
                }
                
                myPlotSet=$('#inputPlotSet').val().replace(/\"/g,"");
                myPackage=$('#inputPackage').val();
                myVariable=$('#inputVariable').val();
                mySeason=$('#inputSeason').val();
                myObs=$('#inputObs').val();
                
                $.ajax({url:'http://localhost:8000/diag/api/run_elo/',
                    data:{'plot_package':myPackage,'plot_set':myPlotSet, 'variableID':myVariable, 'seasonID':mySeason, 'plot_obs':myObs},
                    type:'GET',
                    success:function(data){
                        task_id=data['task_id'];
			//$('#resultTable').append("<tr><td><a href=javascript:toggle("+task_id+");>"+task_id+"</a></td></tr><tr><td><div id=" + task_id+" style='display:none'></div></td></tr>");
                        $('#resultTable').append("<tr><td><a href=javascript:toggle("+task_id+");>"+task_id+"</a></td><td>&nbsp;<div id=progress"+task_id+ " class='progress progress-striped active'><div class='progress-bar'  role='progressbar' aria-valuenow=45 aria-valuemin=0 aria-valuemax=100 style='width: 40px'></div></div></td></tr><tr><td><div id=" + task_id+" style='display:none'></div></td></tr>");
                        //updateLoop(task_id);
                        (function updateLoop(task_id){
                            $.ajax({url:'http://localhost:8000/diag/api/get_status/'+task_id+'/', data:{},type:'GET',
                            success: function(data1){
                                myStatus=data1['status'];
                                if (myStatus=='0')
                                {
                                    setTimeout(function() {updateLoop(task_id);}, 1000);
                                }
                                else
                                {
                                    $("#progress"+task_id).remove();
                                    toggle(task_id);  
                                }
                            },
                            error: function(){alert('ERROR in progress bar update');}});
                        })(task_id);
                    },
                    error: function(){alert('ERROR: unable to get task id');}
                    });
                $('#diagCollapseTwo').collapse('show');
        });

        $('#resultTable a').click(function(e){
            alert($(this).id);
        });

        $('#inputPackage').change(function() {
                $.ajax({url:'http://localhost:8000/diag/api/get_plot_obs/',
                data:{},
                type:'GET',
                success:function(data){
                    plot_obs_list=data['observation_list'];
                    plot_obs_list.sort();
                    $('#inputObs').empty();
                    $('#inputObs').append("<option value=''></option>");
                    for (var i = 0; i< plot_obs_list.length; i++)
                    {
                        opt=plot_obs_list[i];
                        if (opt=="NCEP")
                        {
                            $('#inputObs').append("<option value="+'"' + opt +'"'+" selected>"+opt+"</option>");
                        };
                        $('#inputObs').append("<option value="+'"' + opt +'"'+">"+opt+"</option>");
                    }
                },
                error: function(){alert('ERROR: unable to get plot observations');}
                });
            myPackage=$('#inputPackage').val();
            $.ajax({url:'http://localhost:8000/diag/api/get_plot_set/',
                data:{'plot_package':myPackage},
                type:'GET',
                success:function(data){
                    plot_set_list=data['plot_set'];
                    plot_set_list.sort();
                    $('#inputPlotSet').empty();
                    $('#inputPlotSet').append("<option value=''></option>");
                    for (var i = 0; i< plot_set_list.length; i++)
                    {
                        opt=plot_set_list[i];
                        $('#inputPlotSet').append("<option value="+'"' + opt +'"'+">"+opt+"</option>");
                    }
                },
                error: function(){alert('ERROR: unable to get plot set');}
                });
            $.ajax({url:'http://localhost:8000/diag/api/get_plot_seasons/',
                data:{'plot_package':myPackage},
                type:'GET',
                success:function(data){
                    plot_seasons=data['season_list'];
                    plot_seasons.sort();
                    $('#inputSeason').empty();
                    $('#inputSeason').append("<option value=''></option>");
                    for (var i = 0; i< plot_seasons.length; i++)
                    {
                        opt=plot_seasons[i];
                        $('#inputSeason').append("<option value=" + opt +">"+opt+"</option>");
                    }
                },
                error: function(){alert('ERROR: unable to get plot set');}
                });
        });
        $('#inputPlotSet').change(function() {
            myPlotSet=$('#inputPlotSet').val();
            myPackage=$('#inputPackage').val();
            myObs=$('#inputObs').val();
            $.ajax({url:'http://localhost:8000/diag/api/get_plot_variable/',
                data:{'plot_package':myPackage,'plot_set':myPlotSet,'plot_obs':myObs},
                type:'GET',
                success:function(data){
                    plot_variables=data['variables_list'];
                    plot_variables.sort();
                    $('#inputVariable').empty();
                    $('#inputVariable').append("<option value=''></option>");
                    for (var i = 0; i< plot_variables.length; i++)
                    {
                        opt=plot_variables[i];
                        $('#inputVariable').append("<option value=" + opt +">"+opt+"</option>");
                    }
                },
                error: function(){alert('ERROR: unable to get plot variables');}
                });
        });

        $('#inputVariable').change(function() {
            myPlotSet=$('#inputPlotSet').val();
            myPackage=$('#inputPackage').val();
            myVariable=$('#inputVariable').val();
            myObs=$('#inputObs').val();
            $.ajax({url:'http://localhost:8000/diag/api/get_plot_aux_options/',
                data:{'plot_package':myPackage,'plot_set':myPlotSet, 'plot_variable':myVariable,'plot_obs':myObs},
                type:'GET',
                success:function(data){
                    plot_aux=data['aux_list'];
                    $('#inputAux').empty();
                    $('#inputAux').append("<option value=''></option>");
                    if (plot_aux != null)
                    {
                        for (var i = 0; i< plot_aux.length; i++)
                        {
                            opt=plot_aux[i];
                            $('#inputAux').append("<option value=" + opt +">"+opt+"</option>");
                        }
                    };
                },
                error: function(){alert('ERROR: unable to get plot auxiliary');}
                });
        });

//	var pv = { pipeline: null, sources: null, files: null},
//    fetchDataQueueSize = 0;
//    $("#loading").hide();
//    pv.connection = { sessionURL: "ws://localhost:8080/ws"};
//    connect();
//
//    function connect() {
//        if(location.protocol == "http:") {
//            pv.connection.sessionURL = pv.connection.sessionURL.replace("wss:","ws:");
//        }
//
//        vtkWeb.connect(pv.connection, function(connectionData) {
//            pv.connection = connectionData;
//            createViewport();
//            testDisplay();
//        }, function(code,reason){
//            $(".loading").hide();
//            console.log(reason);
//        });
//    }
//
//    function createViewport() {
//        $(".viewport-container").empty();
//        pv.viewport = vtkWeb.createViewport({session: pv.connection.session});
//        pv.viewport.bind(".viewport-container");
//    }
//
//    function initRender() {
//        if (pv.connection && pv.connection.session) {
//            pv.connection.session.call("vtk:initRender").then(function(res) {
//            	console.log(res);
//                pv.viewport.render();
//                console.log("called pv.viewport.render()");
//            });
//        }
//    }
//
//    $(window).resize(function() {
//        $(".splitter").height(window.innerHeight - 35);
//        $(".control-panel").height(window.innerHeight - 35);
//    }).trigger('resize');
//
//    function updateView() {
//        if(pv.viewport) {
//            pv.viewport.invalidateScene();
//        }
//    }
//
//    function stop() {
//        if(pv.hasOwnProperty('connection') && pv.connection.session) {
//            pv.viewport.unbind();
//            vtkWeb.stop(pv.connection);
//            pv = {};
//        }
//    }

    var remoteConnection = new uvis.remoteConnection(),
        myplot1 = new uvis.plot("#viewport-container1",
                               {"connection": remoteConnection}),
        myplot3 = new uvis.plot("#viewport-container3",
                               {"connection": remoteConnection}),
        myplot4 = new uvis.plot("#viewport-container4",
                               {"connection": remoteConnection}),
        myview = new uvis.view(),
        myplot2 = new uvis.plot("#viewport-container2",
                               {"connection": remoteConnection});

    myview.addPlot(myplot1);
    myview.addPlot(myplot2);
    myview.addPlot(myplot3);
    myview.addPlot(myplot4);

    function getActiveSheet(){
        var childrenList=$("#sheetTab").children();
        var len=childrenList.length;
        for (i=0; i<len; i++){
            if (childrenList[i].hasAttribute('class'))
            {
                mySheet=childrenList[i].text;
                return mySheet;
            }
        }
    }

    function getFilename(mySheet,myCanvas){
        myID=mySheet+myCanvas;
        return $('#'+myID).val();
    }

    myplot1.on('mousemove', function(evt) {
      var elem_position = $(evt.delegateTarget).offset();
          evt["x"] = evt.pageX - elem_position.left;
          evt["y"] = evt.pageY - elem_position.top;
      var evtInfo = {};
      evtInfo.x = evt["x"];
      evtInfo.y = evt["y"];

      myplot1.getData(evtInfo, function(data){
        console.log('data ', evtInfo,data);
        $("#data1").text(data);
      });
    });
    myplot2.on('mousemove', function(evt) {
      var elem_position = $(evt.delegateTarget).offset();
          evt["x"] = evt.pageX - elem_position.left;
          evt["y"] = evt.pageY - elem_position.top;
      var evtInfo = {};
      evtInfo.x = evt["x"];
      evtInfo.y = evt["y"];

      myplot2.getData(evtInfo, function(data){
        console.log('data ', evtInfo,data);
        $("#data2").text(data);
      });
    });
    myplot3.on('mousemove', function(evt) {
      var elem_position = $(evt.delegateTarget).offset();
          evt["x"] = evt.pageX - elem_position.left;
          evt["y"] = evt.pageY - elem_position.top;
      var evtInfo = {};
      evtInfo.x = evt["x"];
      evtInfo.y = evt["y"];

      myplot3.getData(evtInfo, function(data){
        console.log('data ', evtInfo,data);
        $("#data3").text(data);
      });
    });
    myplot4.on('mousemove', function(evt) {
      var elem_position = $(evt.delegateTarget).offset();
          evt["x"] = evt.pageX - elem_position.left;
          evt["y"] = evt.pageY - elem_position.top;
      var evtInfo = {};
      evtInfo.x = evt["x"];
      evtInfo.y = evt["y"];

      myplot4.getData(evtInfo, function(data){
        console.log('data ', evtInfo,data);
        $("#data4").text(data);
      });
    });
    function initSheet(){
      myview.createContext();
      //var data = "/home/aashish/workspace/data/documents/clt.nc";
      //myplot1.setData(data, function() { myplot1.render() });
    }
    remoteConnection.connect(initSheet);

    /**
    function testDisplay() {
      var data = "/export/leung25/Downloads/clt.nc";
      myplot.setData(data);
      myplot2.setData(data);
      myview.createContext();
      myview.render();
    }

    // When connected call our display method
    remoteConnection.connect(testDisplay);
    **/

//    var container = $(".viewport-container");
//    container.bind('mouse', function(evt){
//        evt.preventDefault();
//        var vtkWeb_event = {
//            action: evt.action,
//            charCode: evt.charCode,
//            altKey: evt.altKey,
//            ctrlKey: evt.ctrlKey,
//            shiftKey: evt.shiftKey,
//            metaKey: evt.metaKey,
//            buttonLeft: (evt.current_button === 1 ? true : false),
//            buttonMiddle: (evt.current_button === 2 ? true : false),
//            buttonRight: (evt.current_button === 3 ? true : false)
//            },
//            elem_position = $(evt.delegateTarget).offset(),
//            pointer = {
//                    x : (evt.pageX - elem_position.left),
//                    y : (evt.pageY - elem_position.top)
//            };
//
//        vtkWeb_event.x = pointer.x;
//        vtkWeb_event.y = pointer.y;
//
//        action_pending = true;
//        pv.connection.session.call("vtk:mouseInteraction", vtkWeb_event).then(function (res) {
//            if (res !== null) {
//                action_pending = false;
//                console.log(res);
//                $("#data").text(res);
//            }
//        });
//    });

    </script>
</body>
</html>
