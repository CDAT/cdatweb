#!/bin/bash

@SOURCE_UVCDAT@

prefix=$(cd "${BASH_SOURCE%/*}/.."; pwd)

LD_LIBRARY_PATH=$prefix/lib${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}
LD_LIBRARY_PATH=$prefix/lib@LIB_SUFFIX@:$LD_LIBRARY_PATH

PYTHONPATH=$prefix/lib@LIB_SUFFIX@${PYTHONPATH:+:$PYTHONPATH}
PYTHONPATH=$prefix/lib@LIB_SUFFIX@/@PYTHON_SHORT@/site-packages:$PYTHONPATH
PYTHONPATH=$prefix/lib/@PYTHON_SHORT@/site-packages:$PYTHONPATH

PATH=$prefix/bin:$PATH
export PYTHONPATH LD_LIBRARY_PATH PATH

data=$prefix/share/uvis/www
common_content=$data/content
app_data=$data/apps/@APPLICATION@
app_content=$app_data/content
django_script=$app_data/bin/manage.py

# For django
PYTHONPATH=$app_data:$PYTHONPATH

# For uvis module
PYTHONPATH=$app_data/bin:$PYTHONPATH

# For other modules
PYTHONPATH=$prefix/share/uvis/modules:$PYTHONPATH

echo $PYTHONPATH

exec python -m @SERVER_PYTHON_SCRIPT@ \
  --port ${PORT:-8080} \
  --content $common_content \
  --app-content $app_content \
  "$@" &

exec python $django_script runserver 0.0.0.0:8000 &
